{%- liquid
  assign product = all_products[settings.cart_product_gift]
  assign product_downcase = product | downcase
  assign id = product.selected_or_first_available_variant.id | minus: 0

  assign check = false
  for item in cart.items
    if item.id == id
      assign check = true
    endif
  endfor

  capture icon_spinner
    render 'icon-spinner'
  endcapture
-%}

<cart-drawer
  class="drawer pos-fixed top-0 left-0 z-index-8 w-100v h-100 d-flex j-c-end{% if cart == empty %} is-empty{% endif %} color-{{ settings.cart_color_scheme }} gradient"
  id="Cart-Drawer"
  data-url-style-sheet="{{ 'component-cart.css' | asset_url }}"
>
  <div class="side-drawer cart-drawer pos-relative style--{{ settings.cart_style }}">
    <div class="loading-overlay pos-absolute w-100 h-100 top-0 left-0 d-flex a-i-center j-c-center z-index-10 hidden">
      <div class="loading-overlay__spinner d-inline-block">{{ icon_spinner }}</div>
    </div>
    <div id="Drawer-Overlay-Cart" class="drawer__overlay pos-fixed top-0 left-0 right-0 bottom-0 c-pointer"></div>
    <div id="CartDrawer" class="h-100{% if settings.show_quick_cart_popular_product %} pos-relative z-index-2{% endif %} gradient">
      {%- if settings.show_quick_cart_popular_product and settings.quick_cart_popular_product_collection.products.size > 1 -%}
        {%- liquid
            assign collection = settings.quick_cart_popular_product_collection.products
            assign limit = settings.quick_cart_popular_product_show
        -%}
        <div class="recommendCartCollection recommendCartCollection-desk h-100 top-0 gradient d-none-xs">
          <div class="recommendCartCollection-inner d-flex f-column{% if settings.use_background_gradient %} bg-gradient{% endif %}"
            style="
              {%- if settings.use_background_gradient %}
                --bg-gradient-special: {% if settings.gradient_background_special != blank %}{{ settings.gradient_background_special }}{% else %}{{ settings.colors_background_special }}{% endif %};
              {% endif -%}
            "
          >
            {% if settings.quick_cart_popular_product_title != blank %}
              <div class="drawer__header">
                <h2 class="recommendCartTitle text-left{% if settings.cart_style == 'special' %} text-size{% endif %}">
                  {{ settings.quick_cart_popular_product_title | escape }}         
                </h2>
              </div>
            {% endif %}
            <div class="recommendCartProduct h-100" data-product-collection-cart>
              <ul class="recommendCartCarousel-list list-unstyled cus-scrollbar">
                {%- for product in collection limit: limit -%}
                  <li class="recommendCartItem">
                    {% render 'card-product',
                      card_product: product,
                      product_cards_style: 'card',
                      media_aspect_ratio: settings.card_image_ratio,
                      show_secondary_image: settings.show_secondary_image,
                      show_vendor: settings.show_vendor_product,
                      show_vendor_mobile: settings.show_vendor_mobile,
                      show_rating: false,
                      show_rating_mobile: false,
                      show_quick_add: settings.enable_quick_add,
                      show_quick_add_mobile: settings.enable_quick_add_mobile,
                      show_swatch: false,
                      show_swatch_mobile: false,
                      show_wishlist: false,
                      show_wishlist_mobile: false,
                      card_button_text_size: settings.card_button_text_size,
                      card_button_type: settings.card_button_type,
                      card_button_transform: settings.card_button_transform,
                      index: forloop.index,
                      section_id: section.id
                    %}
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          </div>
        </div>
      {%- endif -%}
      <div
        class="drawer__inner gradient d-flex f-column h-100{% if settings.use_background_gradient %} bg-gradient{% endif %}"
        role="dialog"
        aria-modal="true"
        aria-label="{{ 'sections.cart.title' | t }}"
        tabindex="-1"
        style="
          {%- if settings.use_background_gradient %}
            --bg-gradient-special: {% if settings.gradient_background_special != blank %}{{ settings.gradient_background_special }}{% else %}{{ settings.colors_background_special }}{% endif %};
          {% endif -%}
        "
      >
        <div class="drawer__header d-flex j-c-between a-i-center pos-relative">
          <h2 class="drawer__heading break m-0{% if settings.cart_style == 'special' %} text-size{% endif %}">{{ 'sections.cart.title' | t }}</h2>
          <button
            class="drawer__close d-block t-button b-none b-circle c-pointer button--close"
            type="button"
            onclick="this.closest('cart-drawer').close()"
            aria-label="{{ 'accessibility.close' | t }}"
          >
            <span class="i__close e-none d-block pos-relative color-current w-100 h-100"></span>
          </button>
        </div>
        {%- if settings.cart_style == 'special' -%}
          <div class="wrapper-cartCount color-light subrte">
            <span class="cartCount" data-cart-count>{{ cart.item_count }}</span>
            <span>{{ 'general.cart.items' | t }}</span>
          </div>
        {%- endif -%}
        {%- if settings.show_free_shipping_notification -%}
          <cart-message
            class="cart__shipping-message d-block pos-relative style--{{ settings.cart_style }}{% if cart == empty and settings.cart_style != 'special' %} hidden{% endif %}"
            data-price="{{ settings.minimum_order_price_for_free_shipping }}"
            data-total="{{ cart.total_price | divided_by: 100 }}"
            data-symbol="{{ shop.money_format }}"
            data-first-text="{{ 'sections.cart.free_shipping.text_1' | t }}"
            data-second-text="{{ 'sections.cart.free_shipping.text_2' | t }}"
            data-third-text="{{ 'sections.cart.free_shipping.text_3' | t }}"
          >
            <div
              class="progress pos-relative"
              style="
                --color-background: {{ settings.colors_background_progress_free_shipping.red }}, {{ settings.colors_background_progress_free_shipping.green }}, {{ settings.colors_background_progress_free_shipping.blue }};
                --gradient-background: {% if settings.gradient_background_progress_free_shipping != blank %}{{ settings.gradient_background_progress_free_shipping }}{% else %}{{ settings.colors_background_progress_free_shipping }}{% endif %};
              "
            >
              <div
                class="progress__shipping gradient{% if settings.cart_style == 'special' %} o-h{% endif %}"
                role="progressbar"
                aria-label="{{ 'sections.cart.free_shipping.text_1' | t: price: settings.minimum_order_price_for_free_shipping }}"
              >
                <div class="progress__meter d-block pos-relative h-100"></div>
              </div>
            </div>
            <div class="message color-light subrte"></div>
          </cart-message>
        {%- endif -%}
        <div id="previewCart-wrapper" class="previewCart-wrapper d-flex f-column j-c-between o-h h-100">
          <div class="previewCart">
            <div id="Overlay-Preview-Cart" class="drawer__overlay pos-fixed top-0 left-0 right-0 bottom-0 c-pointer"></div>
            <cart-drawer-items class="f-1 overflow-y scroll-visible{% if cart == empty %} is-empty{% endif %}">
              <form
                action="{{ routes.cart_url }}"
                id="CartDrawer-Form"
                class="cart__contents cart-drawer__form d-flex f-wrap f-grow"
                method="post"
              >
                <div id="CartDrawer-CartItems" class="drawer__contents js-contents d-flex f-1 f-column">
                  {%- if cart != empty -%}
                    <div class="drawer__cart-items-wrapper f-grow">
                      <ul class="cart-items list-unstyled d-flex f-column g-gap w-100" role="list" style="--g-gap: 2rem;">
                        {%- for item in cart.items -%}
                          <li
                            id="CartDrawer-Item-{{ item.index | plus: 1 }}"
                            class="cart-item d-block c-inline pos-relative gradient"
                            role="listItem"
                          >
                            <div class="cart-item__media d-inline-block v-a-top pos-relative center">
                              <a href="{{ item.url }}" class="cart-item__link d-block w-100 color-foreground u-none">
                                {%- liquid
                                  if settings.cart_style != 'special'
                                    assign cartWidth = '100'
                                  else
                                    assign cartWidth = '112'
                                  endif
                                -%}
                                {%- if item.image -%}
                                  <img
                                    class="cart-item__image"
                                    src="{{ item.image | image_url: width: 200 }}"
                                    alt="{{ item.image.alt | escape }}"
                                    loading="lazy"
                                    width="{{ cartWidth }}"
                                    height="{{ 100 | divided_by: item.image.aspect_ratio | ceil }}"
                                  >
                                {%- else -%}
                                  {% capture current %}{% cycle 1, 2, 3, 4, 5, 6 %}{% endcapture %}
                                  {{ 'product-' | append: current | placeholder_svg_tag: 'placeholder-svg' }}
                                {%- endif -%}
                              </a>
                            </div>
                            <div class="cart-item__details d-inline-block v-a-top pos-relative left">
                              {%- if settings.cart_style == 'special' -%}
                                <cart-remove-button
                                  class="cart-item__remove cart-item__remove-header cart-remove d-flex a-i-center pos-absolute right-0 top-0"
                                  id="CartDrawer-Remove-{{ item.index | plus: 1 }}"
                                  data-index="{{ item.index | plus: 1 }}"
                                >
                                  <button
                                    type="button"
                                    class="d-flex a-i-center j-c-center t-button c-pointer p-0 gradient button--close"
                                    aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                                  >
                                    <span class="i__close e-none d-block pos-relative color-current w-100 h-100"></span>
                                  </button>
                                </cart-remove-button>
                              {%- endif -%}
                              {%- if settings.show_vendor -%}
                                <p class="caption-with-letter-spacing uppercase">{{ item.product.vendor }}</p>
                              {%- endif -%}
                              <a
                                href="{{ item.url }}"
                                class="cart-item__name d-block w-100 link link--style-line u-none color-foreground h4 break"
                              >
                                <span class="link-style">{{ item.product.title | escape }}</span>
                              </a>
                              {%- if item.product.has_only_default_variant == false -%}
                                <div class="cart-item__options color-light subrte {% if settings.show_quick_edit_cart %} d-flex a-i-center{% endif %}">
                                  <span class="cart-item__options-variant">
                                    {{ item.variant.title }}
                                  </span>
                                  {% comment %} {%- if settings.show_quick_edit_cart -%}
                                    <button type="button" class="cart-item__options-edit c-pointer m-l" style="--m-l: .8rem;" data-open-edit-cart data-edit-cart-url="{{ item.url }}&view=ajax_edit_cart" data-edit-cart-id="{{ item.id }}" data-edit-cart-quantity="{{ item.quantity }}" data-line="{{ item.key }}" title="{{ 'sections.cart.remove_title' | t: title: item.variant.title }}">
                                        {% render 'icon-edit' %}
                                    </button>
                                  {%- endif -%} {% endcomment %}
                                </div>
                              {%- endif -%}
                              {%- if item.properties.size != 0 or item.selling_plan_allocation != null -%}
                                <dl class="cart-item__properties color-light subrte">
                                  {%- for property in item.properties -%}
                                    {%- assign property_first_char = property.first | slice: 0 -%}
                                    {%- if property.last != blank and property_first_char != '_' -%}
                                      <div class="cart-item__option">
                                        <dt class="d-inline break m-0">{{ property.first }}:</dt>
                                        <dd class="d-inline break m-0">
                                          {%- if property.last contains '/uploads/' -%}
                                            <a
                                              href="{{ property.last }}"
                                              class="link u-u u-link"
                                              target="_blank"
                                              aria-describedby="a11y-new-window-message"
                                            >
                                              {{ property.last | split: '/' | last }}
                                            </a>
                                          {%- else -%}
                                            {{ property.last }}
                                          {%- endif -%}
                                        </dd>
                                      </div>
                                    {%- endif -%}
                                  {%- endfor -%}
                                </dl>
                                <p class="cart-item__properties color-light subrte">
                                  {{ item.selling_plan_allocation.selling_plan.name }}
                                </p>
                              {%- endif -%}
                              <ul
                                class="discounts list-unstyled"
                                role="list"
                                aria-label="{{ 'customer.order.discount' | t }}"
                              >
                                {%- for discount in item.discounts -%}
                                  <li class="discounts__discount d-flex a-i-center caption-large">
                                    {%- render 'icon-discount' -%}
                                    {{ discount.title }}
                                  </li>
                                {%- endfor -%}
                              </ul>
                              <div class="cart-item__quantity d-flex f-wrap{% if settings.cart_style != 'special' %} f-column a-i-start j-c-start{% endif %}">
                                {%- if item.original_price != item.final_price -%}
                                  <div
                                    class="cart-item__discounted-prices d-flex{% if settings.cart_style != 'special' %} f-wrap a-i-center j-c-start c-gap{% else %} f-column right{% endif %}"
                                    style="--c-gap: 1rem;"
                                  >
                                    <span class="visually-hidden">
                                      {{ 'products.product.price.regular_price' | t }}
                                    </span>
                                    <s class="cart-item__old-price">
                                      {{- item.original_price | money -}}
                                    </s>
                                    <span class="visually-hidden">
                                      {{ 'products.product.price.sale_price' | t }}
                                    </span>
                                    <strong class="cart-item__final-price">
                                      {{ item.final_price | money }}
                                    </strong>
                                    <small class="unit-price caption d-block w-100{% if item.unit_price_measurement == nil %} hidden{% endif %}">
                                      <span class="visually-hidden">{{ 'products.product.price.unit_price' | t }}</span>
                                      <span class="price-item price-item--last">
                                        <span>{{- item.unit_price | money -}}</span>
                                        <span aria-hidden="true">/</span>
                                        <span class="visually-hidden"
                                          >&nbsp;{{ 'accessibility.unit_price_separator' | t }}&nbsp;</span
                                        >
                                        <span>
                                          {%- if item.unit_price_measurement.reference_value != 1 -%}
                                            {{- item.unit_price_measurement.reference_value -}}
                                          {%- endif -%}
                                          {{ item.unit_price_measurement.reference_unit }}
                                        </span>
                                      </span>
                                    </small>
                                  </div>
                                {%- else -%}
                                  <div class="cart-item__option-prices d-block left">
                                    {{ item.original_price | money }}
                                    <small class="unit-price caption d-block w-100{% if item.unit_price_measurement == nil %} hidden{% endif %}">
                                      <span class="visually-hidden">{{ 'products.product.price.unit_price' | t }}</span>
                                      <span class="price-item price-item--last">
                                        <span>{{- item.unit_price | money -}}</span>
                                        <span aria-hidden="true">/</span>
                                        <span class="visually-hidden"
                                          >&nbsp;{{ 'accessibility.unit_price_separator' | t }}&nbsp;</span
                                        >
                                        <span>
                                          {%- if item.unit_price_measurement.reference_value != 1 -%}
                                            {{- item.unit_price_measurement.reference_value -}}
                                          {%- endif -%}
                                          {{ item.unit_price_measurement.reference_unit }}
                                        </span>
                                      </span>
                                    </small>
                                  </div>
                                {%- endif -%}
                                <div class="cart-item__quantity-wrapper d-flex a-i-center">
                                  <quantity-input class="quantity cart-quantity d-flex pos-relative">
                                    <button
                                      class="quantity__button f-shrink t-button b-none c-pointer bg-transparent p-0 d-flex a-i-center j-c-center no-js-hidden"
                                      name="minus"
                                      type="button"
                                    >
                                      <span class="visually-hidden">
                                        {{-
                                          'products.product.quantity.decrease'
                                          | t: product: item.product.title
                                          | escape
                                        -}}
                                      </span>
                                      {% render 'icon-minus' %}
                                    </button>
                                    <input
                                      class="quantity__input t-button b-none bg-transparent w-100 f-grow center"
                                      type="number"
                                      data-quantity-variant-id="{{ item.variant.id }}"
                                      name="updates[]"
                                      value="{{ item.quantity }}"
                                      {% # theme-check-disable %}
                                      data-cart-quantity="{{ cart | item_count_for_variant: item.variant.id }}"
                                      min="{{ item.variant.quantity_rule.min }}"
                                      {% if item.variant.quantity_rule.max != null %}
                                        max="{{ item.variant.quantity_rule.max }}"
                                      {% endif %}
                                      step="{{ item.variant.quantity_rule.increment }}"
                                      {% # theme-check-enable %}
                                      aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                                      id="Drawer-quantity-{{ item.index | plus: 1 }}"
                                      data-index="{{ item.index | plus: 1 }}"
                                    >
                                    <button
                                      class="quantity__button f-shrink t-button b-none c-pointer bg-transparent p-0 d-flex a-i-center j-c-center no-js-hidden"
                                      name="plus"
                                      type="button"
                                    >
                                      <span class="visually-hidden">
                                        {{-
                                          'products.product.quantity.increase'
                                          | t: product: item.product.title
                                          | escape
                                        -}}
                                      </span>
                                      {% render 'icon-plus' %}
                                    </button>
                                  </quantity-input>
                                  {%- if settings.cart_style != 'special' -%}
                                    <cart-remove-button
                                      class="cart-item__remove cart-remove d-flex a-i-center"
                                      id="CartDrawer-Remove-{{ item.index | plus: 1 }}"
                                      data-index="{{ item.index | plus: 1 }}"
                                    >
                                      <button
                                        type="button"
                                        class="d-flex a-i-center j-c-center t-button c-pointer b-circle p-0 gradient"
                                        aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                                      >
                                        {% render 'icon-remove' %}
                                      </button>
                                    </cart-remove-button>
                                  {%- endif -%}
                                </div>
                                <div
                                  id="CartDrawer-LineItemError-{{ item.index | plus: 1 }}"
                                  class="cart-item__error d-flex a-i-start w-100"
                                  role="alert"
                                >
                                  <small class="cart-item__error-text f-italic subrte"></small>
                                  {% render 'icon-error' %}
                                </div>
                              </div>
                            </div>
                          </li>
                        {%- endfor -%}
                      </ul>
                    </div>
                  {%- endif -%}
                  <p id="CartDrawer-LiveRegionText" class="visually-hidden" role="status"></p>
                  <p id="CartDrawer-LineItemStatus" class="visually-hidden" aria-hidden="true" role="status">
                    {{ 'accessibility.loading' | t }}
                  </p>
                </div>
                <div id="CartDrawer-CartErrors" role="alert"></div>
              </form>
            </cart-drawer-items>
            {%- if settings.show_quick_cart_popular_product and settings.quick_cart_popular_product_collection.products.size > 1 -%}
              {%- liquid
                  assign collection = settings.quick_cart_popular_product_collection.products
                  assign limit = settings.quick_cart_popular_product_show
              -%}
              <div class="recommendCartCollection recommendCartCollection-mobile d-none-md">
                {% if settings.quick_cart_popular_product_title != blank %}
                  <div class="drawer__header">
                    <h2 class="recommendCartTitle text-left{% if settings.cart_style == 'special' %} text-size{% endif %}">
                      {{ settings.quick_cart_popular_product_title | escape }}         
                    </h2>
                  </div>
                {% endif %}
                <ul class="recommendCartProduct-list list-unstyled" role="list">
                  {%- for product in collection limit: limit -%}
                    <li
                      role="listitem"
                      id="CartDrawerMobible-Item-{{ product.index | plus: 1 }}"
                      class="d-flex c-inline pos-relative style-product-card gradient"
                    >
                      <div class="cart-item__media d-inline-block v-a-top pos-relative center">
                        <a href="{{ product.url }}" class="cart-item__link d-block w-100 color-foreground u-none">
                          {%- liquid
                            if settings.cart_style != 'special'
                              assign cartWidth = '100'
                            else
                              assign cartWidth = '112'
                            endif
                          -%}
                          {%- if product.featured_media -%}
                            <img
                              class="cart-item__image"
                              src="{{ product.featured_media | image_url: width: 200 }}"
                              alt="{{ product.featured_media.alt | escape }}"
                              loading="lazy"
                              width="{{ cartWidth }}"
                              height="{{ 100 | divided_by: product.featured_media.aspect_ratio | ceil }}"
                            >
                          {%- else -%}
                            {% capture current %}{% cycle 1, 2, 3, 4, 5, 6 %}{% endcapture %}
                            {{ 'product-' | append: current | placeholder_svg_tag: 'placeholder-svg' }}
                          {%- endif -%}
                        </a>
                      </div>
                      <div class="cart-item__details d-flex f-column v-a-top pos-relative left">
                        {%- if settings.show_vendor_mobile -%}
                          <p class="caption-with-letter-spacing uppercase">{{ product.vendor }}</p>
                        {%- endif -%}
                        <a
                          href="{{ product.url }}"
                          class="cart-item__name d-block w-100 link link--style-line u-none color-foreground h4 break"
                        >
                          <span class="link-style">{{ product.title | escape }}</span>
                        </a>
  
                        <div class="cart-item__quantity d-flex f-wrap m-t" style="--m-t: auto;">
                          {%- liquid
                            assign product_form_id = 'quick-add-advanced-' | append: section_id | append: product.id
                          -%}
                          <div class="product__price element-spacing-all no-js-hidden" id="price-{{ section.id }}" role="status" {{ block.shopify_attributes }}
                            style="--padding-top: {{ block.settings.padding_top }}px;
                              --padding-bottom: {{ block.settings.padding_bottom }}px;"
                          >
                            {%- render 'price',
                              product: product,
                              use_variant: true,
                              show_you_save: true,
                              main_price: true,
                              price_class: 'price--large'
                            -%}
                          </div>
                            {%- liquid
                              assign product_form_id = 'quick-add-mobile-' | append: section_id | append: product.id
                              assign qty_rules = false
                              if card_product.selected_or_first_available_variant.quantity_rule.min > 1 or card_product.selected_or_first_available_variant.quantity_rule.max != null or card_product.selected_or_first_available_variant.quantity_rule.increment > 1
                                assign qty_rules = true
                              endif
                            -%}
                            {%- if product.variants.size > 1 or qty_rules -%}
                              <modal-opener data-modal="#QuickAdd-{{ product.id }}-mobile" class="d-none-xl">
                                <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" disabled>
                                <button
                                  id="card-{{ product_form_id }}-submit"
                                  type="submit"
                                  name="add"
                                  class="quick-add__submit button button-cart_mobile pos-relative c-pointer b-circle d-inline-flex a-i-center j-c-center"
                                  aria-haspopup="dialog"
                                  aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ product.id }}"
                                  aria-label="{{ 'templates.cart.cart_items' | t: count: cart.item_count }}"
                                  data-product-url="{{ product.url | split: "?" | first }}?view=quick-view"
                                >
                                  <span class="text d-flex a-i-center j-c-center center w-100 e-none">
                                    {% render 'icon-bag' %}
                                  </span>
                                <div class="loading-overlay__spinner z-index-2 hidden d-inline-flex pos-abolute">{{ icon_spinner }}</div>
                                </button>
                              </modal-opener>
                              <quick-add-modal id="QuickAdd-{{ product.id }}-mobile" class="quick-add-modal popup-modal d-flex a-i-center j-c-center pos-fixed top-0 left-0 w-100 h-100 o-h m-auto gradient">
                                <div role="dialog" aria-label="{{ 'products.product.choose_product_options' | t: product_name: product.title | escape }}" aria-modal="true" class="quick-add-modal__content popup-modal__content w-100 h-auto m-auto o-h pos-relative gradient template-popup global-settings-popup" tabindex="-1">
                                  <button id="ModalClose-{{ product.id }}-mobile" type="button" class="quick-add-modal__toggle popup-modal__toggle d-block t-button b-none c-pointer b-circle pos-absolute z-index-3 button--close" aria-label="{{ 'accessibility.close' | t }}">
                                    <span class="i__close e-none d-block pos-relative color-current w-100 h-100"></span>
                                  </button>
                                  <div id="QuickAddInfo-{{ product.id }}" class="quick-add-modal__content-info popup-modal__content-info h-100"></div>
                                </div>
                              </quick-add-modal>
                            {%- else -%}
                              <product-form class="d-none-xl">
                                {%- form 'product',
                                  product,
                                  id: product_form_id,
                                  class: 'form',
                                  novalidate: 'novalidate',
                                  data-type: 'add-to-cart-form'
                                -%}
                                  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" disabled>
                                  <button
                                    id="{{ product_form_id }}-submit"
                                    type="submit"
                                    name="add"
                                    class="quick-add__submit button button-cart_mobile pos-relative c-pointer b-circle d-inline-flex a-i-center j-c-center"
                                    aria-haspopup="dialog"
                                    aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ product.id }}"
                                    aria-label="{{ 'templates.cart.cart_items' | t: count: cart.item_count }}"
                                    aria-live="polite"
                                    data-sold-out-message="true"
                                    {% if product.selected_or_first_available_variant.available == false %}
                                      disabled
                                    {% endif %}
                                  >
                                    <span class="text{% if product.selected_or_first_available_variant.available %} d-flex a-i-center{% endif %} j-c-center center w-100">
                                      {% render 'icon-bag' %}
                                    </span>
                                    <span class="sold-out-message hidden">
                                      {{ 'products.product.sold_out' | t }}
                                    </span>
                                    <div class="loading-overlay__spinner z-index-2 hidden d-inline-block">{{ icon_spinner }}</div>
                                  </button>
                                {%- endform -%}
                              </product-form>
                            {%- endif -%}
                        </div>
                      </div>
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            {%- endif -%}
          </div>

          <div class="cart__totals gradient{% if settings.cart_style == 'special' %} bg-transparent{% endif %}{% if cart == empty %} d-none{% endif %}">
            {%- if settings.show_cart_note or settings.show_cart_gift or settings.show_cart_shipping -%}
              {%- if settings.cart_style != 'special' -%}
                <h3 class="cart__totals-title">{{ 'sections.cart.order_summary' | t }}</h3>
              {%- endif -%}
              <{% if settings.show_cart_gift or settings.show_cart_shipping %}cart-item-tool{% else %}div{% endif %} 
                class="previewCartTool{% if settings.show_cart_gift or settings.show_cart_shipping %} style--special d-flex j-c-center{% endif %}"
              >
                {%- if settings.show_cart_note -%}
                  {%- if settings.show_cart_gift or settings.show_cart_shipping -%}
                    <div class="cartTool-item center c-pointer cart-tool-note" data-popup="popup-tool-note">
                      <span>
                        {% render 'icon-cart-note' %}
                      </span>
                    </div>
                  {%- else -%}
                  <details id="Details-CartDrawer" class="b-bottom">
                    <summary class="c-pointer pos-relative">
                      <span class="summary__title plus">
                        {{ 'sections.cart.note' | t }}
                      </span>
                    </summary>
                    <cart-note class="cart__note d-block field f-a-none f-b-none pos-relative l-h-1">
                      <label class="visually-hidden" for="CartDrawer-Note">{{ 'sections.cart.note' | t }}</label>
                      <textarea
                        id="CartDrawer-Note"
                        class="text-area field__input cart__note--input f-grow left"
                        name="note"
                        placeholder="{{ 'sections.cart.note' | t }}"
                      >{{ cart.note }}</textarea>
                    </cart-note>
                  </details>
                  {%- endif -%}
                {%- endif -%}
                {%- if settings.show_cart_gift and product_downcase != 'emptydrop' and check == false -%}
                  <div class="cartTool-item center c-pointer cart-tool-gift" data-popup="popup-tool-gift">
                      <span>
                          {% render 'icon-cart-gift' %}
                      </span>
                  </div>
                {%- endif -%}
                {%- if settings.show_cart_shipping -%}
                  <div class="cartTool-item center c-pointer cart-tool-shipping" data-popup="popup-tool-shipping">
                    <span>
                        {% render 'icon-cart-shipping' %}
                    </span>
                  </div>
                {%- endif -%}

                {%- if settings.show_cart_gift or settings.show_cart_shipping -%}
                  <div class="popup-toolDowns">
                    {%- if settings.show_cart_note -%}
                        <div class="popup-toolDown pos-fixed bottom-0 right-0 w-100 z-index-9" id="popup-tool-note">
                            <cart-note-popup class="cart__note d-block">
                                <label for="Cart-note" class="d-flex a-i-center capitalize">{% render 'icon-cart-note' %}{{ 'sections.cart.note' | t }}</label>
                                <textarea class="text-area text-area--resize-vertical field__input" name="note" id="Cart-note" placeholder="{{ 'sections.cart.note' | t }}">{{ cart.note }}</textarea>
                                <button 
                                  type="button" 
                                  title="{{ 'general.cart.save' | t }}" 
                                  class="button {{ settings.button_style | prepend: 'button--style-' }} {{ settings.card_button_transform }} w-100{% if settings.view_cart_button_transparent == 'transparent' %} button--transparent{% endif %} color-{{ settings.view_cart_color_scheme }} gradient" 
                                  data-update-note
                                >
                                  <span class="text">
                                    {{ 'general.cart.save' | t }}
                                  </span>
                                  <div class="loading-overlay__spinner d-inline-block z-index-2 hidden">{{ icon_spinner }}</div>
                                </button>
                            </cart-note-popup>
                            <cart-cancel-popup class="pos-absolute top-0 right-0 d-block">
                                <div class="cart-cancel-popup">
                                    <button type="button" title="{{ 'general.cart.cancel' | t }}" class="t-button button--close b-none c-pointer">
                                      <span class="i__close e-none d-block pos-relative color-current w-100 h-100"></span>
                                    </button>
                                </div>
                            </cart-cancel-popup>
                        </div>
                    {%- endif -%}

                    {%- if settings.show_cart_gift and product_downcase != 'emptydrop' and check == false -%}
                        <div class="popup-toolDown pos-fixed bottom-0 right-0 w-100 z-index-9 center" id="popup-tool-gift">
                          <gift-card-cart id="is-a-gift" data-id="{{ id }}" class="is-a-gift center">
                              {% render 'icon-cart-gift' %}
                              <div class="content-gift text-center">
                                {{ 'general.cart.add_a_gift_wrap_content' | t }}
                              </div>
                              <product-form class="d-block">
                              {%- form 'product',
                                product,
                                id: product_form_id,
                                class: 'form',
                                novalidate: 'novalidate',
                                data-type: 'add-to-cart-form'
                              -%}
                                <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" disabled>
                                <button 
                                  id="{{ product_form_id }}-submit" 
                                  type="submit" 
                                  name="add" 
                                  class="quick-add__submit button {{ settings.button_style | prepend: 'button--style-' }} {{ settings.card_button_transform }} w-100{% if settings.view_cart_button_transparent == 'transparent' %} button--transparent{% endif %} color-{{ settings.view_cart_color_scheme }} gradient" 
                                  aria-haspopup="dialog" 
                                  aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ product.id }}" 
                                  aria-live="polite" 
                                  data-sold-out-message="true"
                                  {% if product.selected_or_first_available_variant.available == false %} disabled{% endif %}
                                >
                                  <span class="text{% if product.selected_or_first_available_variant.available %} d-flex a-i-center{% endif %} j-c-center center w-100">
                                    {{ 'general.cart.add_a_gift_wrap' | t }}
                                  </span>
                                  <div class="loading-overlay__spinner d-inline-block z-index-2 hidden">{{ icon_spinner }}</div>
                                </button>
                              {%- endform -%}
                            </product-form>
                            <input type="hidden" value="yes" />
                          </gift-card-cart>
                          <cart-cancel-popup class="pos-absolute top-0 right-0 d-block">
                              <div class="cart-cancel-popup">
                                <button type="button" title="{{ 'general.cart.cancel' | t }}" class="t-button button--close b-none c-pointer">
                                  <span class="i__close e-none d-block pos-relative color-current w-100 h-100"></span>
                                </button>
                              </div>
                          </cart-cancel-popup>
                        </div>
                    {%- endif -%}

                    {%- if settings.show_cart_shipping -%}
                        <div class="popup-toolDown pos-fixed bottom-0 right-0 w-100 z-index-9" id="popup-tool-shipping">
                            {% render 'shipping-rates-calculator' %}
                            <cart-cancel-popup class="pos-absolute top-0 right-0 d-block">
                                <div class="cart-cancel-popup">
                                  <button type="button" title="{{ 'general.cart.cancel' | t }}" class="t-button button--close b-none c-pointer">
                                    <span class="i__close e-none d-block pos-relative color-current w-100 h-100"></span>
                                  </button>
                                </div>
                            </cart-cancel-popup>
                        </div>
                    {%- endif -%}
                  </div>
                {%- endif -%}
              </{% if settings.show_cart_gift or settings.show_cart_shipping %}cart-item-tool{% else %}div{% endif %}>
            {%- endif -%}

            <!-- Subtotals -->
            <div class="cart-drawer__footer d-flex f-column r-gap" style="{% if settings.cart_style != 'special' %}--r-gap: 1rem;{% endif %}" {{ block.shopify_attributes }}>
              <ul class="cart__list{% if settings.cart_style == 'special' %} cart__list--total{% endif %} list-unstyled" role="list" aria-label="{{ 'sections.cart.subtotal' | t }}">
                <li class="d-block c-inline clearfix{% if settings.cart_style == 'special' %} d-flex a-i-center{% endif %}">
                  <div div class="cart__list--name left f-left{% if settings.cart_style == 'special' %} text-size text-size-small{% else %} text-body{% endif %}">{{ 'sections.cart.subtotal' | t }}{% if settings.cart_style == 'special' %}:{% endif %}</div>
                  <div class="cart__list--value{% if settings.cart_style == 'special' %} text-size text-size-small{% else %} text-body{% endif %} right f-right f-bold total">
                      <strong>{{ cart.total_price | money_with_currency }}</strong>
                  </div>
                </li>
              </ul>
              {%- if cart.cart_level_discount_applications.size > 0 -%}
                <ul class="cart__list list-unstyled" role="list" aria-label="{{ 'customer.order.discount' | t }}">
                  {%- for discount in cart.cart_level_discount_applications -%}
                    <li class="d-block c-inline clearfix">
                      <div class="cart__list--name{% if settings.cart_style == 'special' %} text-size text-size-small{% else %} text-body{% endif %} left f-left">
                        {{ discount.title }}
                      </div>
                      <div class="cart__list--value{% if settings.cart_style == 'special' %} text-size text-size-small{% else %} text-body{% endif %} right f-right">
                        -{{ discount.total_allocated_amount | money }}
                      </div>
                    </li>
                  {%- endfor -%}
                </ul>
              {%- endif -%}
              <ul class="cart__list{% if settings.cart_style == 'special' %} cart__list--tax{% endif %} list-unstyled" role="list" aria-label="{{ 'sections.cart.taxes_and_shipping' | t }}">
                <li class="d-block c-inline clearfix">
                  {%- if settings.cart_style != 'special' -%}
                    <div class="cart__list--name{% if settings.cart_style == 'special' %} text-size text-size-small{% else %} text-body{% endif %} left f-left">
                      {{ 'sections.cart.taxes_and_shipping' | t }}
                    </div>
                  {%- endif -%}
                  <div class="cart__list--value{% if settings.cart_style == 'special' %} text-size text-size-small w-100{% else %} text-body right f-right f-italic{% endif %}">
                    <{% if settings.cart_style == 'special' %}span{% else %}em{% endif %}>
                      {%- if cart.taxes_included and shop.shipping_policy.body != blank -%}
                        {{ 'sections.cart.taxes_included_and_shipping_policy_html' | t: link: shop.shipping_policy.url }}
                      {%- elsif cart.taxes_included -%}
                        {{ 'sections.cart.taxes_included_but_shipping_at_checkout' | t }}
                      {%- elsif shop.shipping_policy.body != blank -%}
                        {{ 'sections.cart.taxes_and_shipping_policy_at_checkout_html' | t: link: shop.shipping_policy.url }}
                      {%- else -%}
                        {{ 'sections.cart.taxes_and_shipping_at_checkout' | t }}
                      {%- endif -%}
                    </{% if settings.cart_style == 'special' %}span{% else %}em{% endif %}>
                  </div>
                </li>
              </ul>
            </div>
            <!-- CTAs -->
            <div
              class="cart__ctas d-flex f-wrap g-gap center m-t"
              style="--g-gap: 1rem; --m-t: 2rem;"
              {{ block.shopify_attributes }}
            >
              <noscript>
                <button
                  type="submit"
                  class="cart__update-button button button--secondary {{ settings.button_style | prepend: 'button--style-' }}"
                  form="CartDrawer-Form"
                >
                  <span>{{ 'sections.cart.update' | t }}</span>
                </button>
              </noscript>
              <button
                type="submit"
                id="CartDrawer-Checkout"
                class="cart__checkout-button button {{ settings.button_style | prepend: 'button--style-' }}{% if settings.checkout_button_transparent == 'transparent' %} button--transparent{% endif %} w-100 color-{{ settings.checkout_color_scheme }} gradient"
                name="checkout"
                form="CartDrawer-Form"
                {% if cart == empty %}
                  disabled
                {% endif %}
              >
                <span>{{ 'sections.cart.checkout' | t }}</span>
              </button>
              <a href="{{ routes.cart_url }}" class="button {{ settings.button_style | prepend: 'button--style-' }}{% if settings.view_cart_button_transparent == 'transparent' %} button--transparent{% endif %} w-100 color-{{ settings.view_cart_color_scheme }} gradient">
                <span class="text">{{ 'sections.cart.view_cart' | t }}</span>
              </a>
            </div>
          </div>
          {%- if cart == empty -%}
            <div class="drawer__inner-empty d-flex j-c-center f-column center o-h h-100">
              <div class="cart-drawer__warnings{% if cart == empty %} d-flex f1 f-column j-c-center{% else %} d-none{% endif %}">
                <div class="cart-drawer__empty-content">
                  <h2 class="cart__empty-text">{{ 'sections.cart.empty' | t }}</h2>
                  <a href="{{ routes.all_products_collection_url }}" class="button {{ settings.button_style | prepend: 'button--style-' }}{% if settings.continue_shopping_button_transparent == 'transparent' %} button--transparent{% endif %} color-{{ settings.continue_shopping_color_scheme }} gradient">
                    <span class="text">{{ 'general.continue_shopping' | t }}</span>
                  </a>
                </div>
              </div>
            </div>
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>
  {%- if settings.show_quick_cart_popular_product or settings.show_cart_gift -%}
    {%- if settings.enable_quick_add or settings.enable_quick_add_mobile -%}
      {%- assign files = "quick-add.js, product-form.js" | split: ', ' -%}
      {% render 'theme-loader', files: files %}
    {%- endif -%}
  {%- endif -%}
</cart-drawer>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    function isIE() {
      const ua = window.navigator.userAgent;
      const msie = ua.indexOf('MSIE ');
      const trident = ua.indexOf('Trident/');

      return msie > 0 || trident > 0;
    }

    if (!isIE()) return;
    const cartSubmitInput = document.createElement('input');
    cartSubmitInput.setAttribute('name', 'checkout');
    cartSubmitInput.setAttribute('type', 'hidden');
    document.querySelector('#cart').appendChild(cartSubmitInput);
    document.querySelector('#checkout').addEventListener('click', function (event) {
      document.querySelector('#cart').submit();
    });
  });
</script>