{%- liquid
  assign card_product = product
  assign media_aspect_ratio = settings.card_image_ratio
  assign show_secondary_image = settings.show_secondary_image
  assign show_vendor = settings.show_vendor_product
  assign show_vendor_mobile = settings.show_vendor_mobile
  assign show_rating = settings.show_rating_product
  assign show_rating_mobile = settings.show_rating_mobile
  assign show_quick_add = settings.enable_quick_add
  assign show_quick_add_mobile = settings.enable_quick_add_mobile
  assign show_swatch = settings.show_swatch
  assign show_swatch_mobile = settings.show_swatch_mobile
  assign card_button_text_size = settings.card_button_text_size
  assign card_button_type = settings.card_button_type
  assign card_button_transform = settings.card_button_transform
  assign lazy_load = lazy_load | default: 'true'
  assign section_id = section.id | default: 'wishlist'
-%}

<li class="wishlist__item{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
  {% if settings.animations_reveal_on_scroll %}
    data-cascade
    style="--animation-order: {{ forloop.index }};"
  {% endif %}
>
  {%- if card_product and card_product != empty -%}
    {%- liquid
      assign ratio = 1
      if card_product.featured_media and media_aspect_ratio == 'adapt'
        assign ratio = card_product.featured_media.aspect_ratio
      endif
      if ratio == 0 or ratio == null
        assign ratio = 1
      endif
      capture icon_spinner
        render 'icon-spinner'
      endcapture
      capture icon_caret
        render 'icon-caret'
      endcapture

      assign image_width = image_width | default: '320, 450, 550, 750, 950, 1024, 1200, 1400, 1600, 1800, 2000'
      assign sizes = "(min-width: 361px) calc(100vw/2), calc(100vw/3)"

      assign secondary_image_class = ' card--1-image'
      assign product_img_first_classes = 'img-first motion-reduce'
      assign product_img_second_classes = 'img-second motion-reduce'

      assign product_image = card_product.featured_media | image_url: width: card_product.featured_media.width | image_tag: widths: image_width, sizes: sizes, alt: card_product.featured_media.alt, class: product_img_first_classes
      if card_product.media[1] != nil and show_secondary_image
        assign secondary_image_class = ' card--2-images'
        assign product_image_second = card_product.media[1] | image_url: width: card_product.featured_image.width | image_tag: widths: image_width, sizes: sizes, alt: card_product.title, class: product_img_second_classes
      endif
    -%}
    <div class="product-card-wishlist product-card-wrapper card-wrapper style-product-advanced-default {{ secondary_image_class }} pos-relative h-100">
      <div class="card__wishlist pos-absolute z-index-2 d-flex f-column right">
        <div class="card__function-item card__function-wishlist">
          <button class="wishlist-advanced-default wishlist-item__button-remove pos-relative c-pointer b-circle d-inline-flex a-i-center j-c-center" type="button" aria-haspopup="dialog" aria-label="{{ 'templates.wishlist.wishlist_items' | t: count: cart.item_count }}" data-wishlist-handle="{{ card_product.handle }}">
            {% render 'icon-close-small' %}
          </button>
        </div>
      </div>
      <div class="card card--default d-flex {{ class_card }} rounded-ovh{% unless check_color %} gradient gradient-global{% endunless %} h-100">
        <div class="card__inner pos-relative o-h w-100">
          <div class="card__media o-h">
            <a href="{{ card_product.url }}"
              class="media media--transparent media--{{ media_aspect_ratio }} pos-relative o-h d-block"
              {%- if media_aspect_ratio == 'adapt' %}
                style="padding-bottom: {{ 1 | divided_by: ratio | times: 100 }}%;"
              {% endif -%}
            >
              {%- if card_product.featured_media -%}
                {{ product_image | replace: "src=", 'loading="lazy" decoding="async" src=' }}
                {{ product_image_second | replace: "src=", 'loading="lazy" decoding="async" src=' }}
              {%- else -%}
                {%- liquid
                  assign index = index | default: 1
                  if index > 6
                    assign index = index | modulo: 6 | plus: 1
                  endif
                -%}
                {{ 'product-' | append: index | placeholder_svg_tag: 'placeholder-svg' }}
              {%- endif -%}
            </a>

            {%- liquid 
              assign class_discount = settings.badge_position | replace: 'top left', 'left' | replace: 'top right', 'left' | prepend: 'discounts-style-'
            -%}
            {% render 'product-discounts', product: card_product, class_discount: class_discount %}
          </div>
          {%- liquid
            if settings.sale_badge_type == 'discount'
              assign current_variant = card_product.selected_or_first_available_variant
              if current_variant.compare_at_price > current_variant.price
                assign product_discount_price = current_variant.compare_at_price | minus: current_variant.price | times: 100.0 | divided_by: current_variant.compare_at_price | round | append: '%' | prepend: '-'
              endif
            endif
          -%}
          <div class="card__badge pos-absolute z-index-1 d-flex f-column top left {{ settings.badge_transform }}"
            style="--badge-font-size: {{ settings.badge_font_size }}px;"
          >
            {%- if card_product.compare_at_price > card_product.price and card_product.available -%}
              <span
                id="Badge-{{ section_id }}-{{ card_product.id }}"
                class="badge sale-badge d-inline-block center break gradient {{ settings.badge_button_type }}"
              >
                {%- if settings.sale_badge_type == 'discount' -%}
                  {{ product_discount_price }}
                {%- else -%}
                  {{- 'products.product.on_sale' | t -}}
                {%- endif -%}
              </span>
            {%- endif -%}
            {%- if card_product.available == false -%}
              <span
                id="Badge-{{ section_id }}-{{ card_product.id }}"
                class="badge sold-out-badge d-inline-block center break gradient {{ settings.badge_button_type }}"
              >
                {{- 'products.product.sold_out' | t -}}
              </span>
            {%- endif -%}
          </div>
        </div>
        <div class="card__content w-100 d-grid{% unless show_swatch_mobile %} hide-q-add-mobile{% endunless %}">
          <div class="card__information d-flex f-column"
            {%- if settings.use_custom_color %}
              style="--color-background: {{ settings.cus_card_colors_background.red }}, {{ settings.cus_card_colors_background.green }}, {{ settings.cus_card_colors_background.blue }};
              "
            {%- endif -%}
          >
            <h3 class="card__heading m-0" id="title-{{ section_id }}-{{ card_product.id }}">
              <a 
                href="{{ card_product.url }}" 
                id="CardLink-{{ section_id }}-{{ card_product.id }}" 
                class="full-unstyled-link d-block u-none color-current link-cover" 
                aria-labelledby="CardLink-{{ section_id }}-{{ card_product.id }}"
              >
                {{ card_product.title | escape }}
              </a>
            </h3>
            {%- if show_vendor or show_vendor_mobile -%}
              <div class="card__vendor subrte uppercase{% unless show_vendor_mobile %} d-none-mw-xl{% endunless %}{% unless show_vendor %} d-none-xl{% endunless %}">
                <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
                {{ card_product.vendor }}
              </div>
            {%- endif -%}

            {%- if show_rating or show_rating_mobile -%}
              {%- if card_product.metafields.reviews.rating.value != blank -%}
                {%- liquid
                  assign rating_decimal = 0
                  assign decimal = card_product.metafields.reviews.rating.value.rating | modulo: 1
                  if decimal >= 0.3 and decimal <= 0.7
                    assign rating_decimal = 0.5
                  elsif decimal > 0.7
                    assign rating_decimal = 1
                  endif
                -%}
                <div class="card__rating{% unless show_rating_mobile %} d-none-mw-xl{% endunless %}{% unless show_rating %} d-none-xl{% endunless %}">
                  <div
                    class="rating d-inline-flex"
                    role="img"
                    aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: card_product.metafields.reviews.rating.value, rating_max: card_product.metafields.reviews.rating.value.scale_max }}"
                  >
                    <span aria-hidden="true" class="rating-star d-inline-block l-h-1"
                      style="--rating: {{ card_product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ card_product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"
                    ></span>
                  </div>
                  <p class="rating-text d-none caption m-0">
                    <span aria-hidden="true">
                      {{- card_product.metafields.reviews.rating.value }} /
                      {{ card_product.metafields.reviews.rating.value.scale_max -}}
                    </span>
                  </p>
                  <p class="rating-count d-inline-block caption m-0">
                    <span aria-hidden="true">({{- card_product.metafields.reviews.rating_count -}})</span>
                    <span class="visually-hidden">
                      {{- card_product.metafields.reviews.rating_count }}
                      {{ 'accessibility.total_reviews' | t -}}
                    </span>
                  </p>
                </div>
              {%- endif -%}
            {%- endif -%}

            {%- if show_swatch or show_swatch_mobile or show_quick_add or show_quick_add_mobile -%}
              {%- if card_product.has_only_default_variant == false -%}
                {%- if show_swatch or show_swatch_mobile -%}
                  {%- liquid
                    assign swatch = settings.swatch | split: ',' | strip | downcase | handle
                  -%}
                  {%- for option in card_product.options_with_values -%}
                    {%- liquid
                      assign is_swatch = false
                      assign option_name = option.name | downcase
                      if swatch contains option_name
                        assign is_swatch = true
                        assign option_size = option.values | size
                        assign variants_option1_arr = card_product.variants | map: 'option1'
                        assign variants_option2_arr = card_product.variants | map: 'option2'
                        assign variants_option3_arr = card_product.variants | map: 'option3'
                      endif
                    -%}
                    {%- if is_swatch -%}
                      <div class="card__swatch d-flex f-wrap a-i-center{% unless show_swatch_mobile %} d-none-mw-xl{% endunless %}{% unless show_swatch %} d-none-xl{% endunless %}">
                        {%- for value in option.values -%}
                          {% unless forloop.index > 5 %}
                            {%- liquid
                              assign variant_image = ''
                              for variant in card_product.variants
                                case option.position
                                  when 1
                                    if variants_option1_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                      assign variant_image = card_product.variants[forloop.index0].image
                                      break
                                    endif
                                  when 2
                                    if variants_option2_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                      assign variant_image = card_product.variants[forloop.index0].image
                                      break
                                    endif
                                  when 3
                                    if variants_option3_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                      assign variant_image = card_product.variants[forloop.index0].image
                                      break
                                    endif
                                  when 4
                                    if variants_option3_arr[forloop.index0] == value and card_product.variants[forloop.index0].image
                                      assign variant_image = card_product.variants[forloop.index0].image
                                      break
                                    endif
                                endcase
                              endfor
                            -%}
                            <span
                              class="card__swatch--item d-block pos-relative z-index-2 c-pointer{% unless variant_image != blank and image_bg_url != '' %} pattern-color{% endunless %}"
                              title="{{ value }}" {% unless variant_image != blank and image_bg_url != '' %} style="--border-variant-color: {{ value | split: ' ' | last | handle }};"{% endunless %}
                            >
                              {%- if variant_image != blank -%}
                                <span
                                  class="pattern d-block w-100 h-100 pos-relative center"
                                  style="background-image: url({{ variant_image.src | product_img_url: '30x'}});"
                                  role="none"
                                ></span>
                              {%- else -%}
                                {%- liquid
                                  assign image_bg = value | handle | append: '.' | append: 'png'
                                  assign image_bg_url = ''
                                  if images[image_bg] != blank
                                    assign image_bg_url = image_bg | file_url
                                  else
                                    assign image_bg = value | handle | append: '.' | append: 'jpg'
                                    if images[image_bg] != blank
                                      assign image_bg_url = image_bg | file_url
                                    endif
                                  endif
                                -%}
                                {%- if image_bg_url != '' %}
                                  <span
                                    class="pattern d-block w-100 h-100 pos-relative center"
                                    style="background-image: url({{ image_bg_url }})"
                                    role="none"
                                  ></span>
                                {%- else -%}
                                  <span
                                    class="pattern d-block w-100 h-100 pos-relative center{% if value contains 'white' or value contains 'White' %} pattern-white{% endif %} {{ value }}"
                                    style="background-color: {{ value | split: ' ' | last | handle }};"
                                    role="none"
                                  ></span>
                                {%- endif -%}
                              {%- endif -%}
                            </span>
                          {%- endunless -%}
                        {%- endfor -%}
                        {%- if option_size > 5 -%}
                          {%- assign count = option_size | minus: 5 -%}
                          <span class="card__swatch--count color-light">
                            {{ 'products.product.more_variants' | t: count: count }}
                          </span>
                        {%- endif -%}
                      </div>
                      {% break %}
                    {%- endif -%}
                  {%- endfor -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}

            <div class="advanced__default-price-cart d-flex a-i-center j-c-between c-gap break" style="--c-gap: 0.5rem;">
              <div class="card__price">
                {% render 'price', product: card_product, price_class: '' %}
              </div>
              {%- if show_quick_add or show_quick_add_mobile -%}
                {%- liquid
                  assign product_form_id = 'quick-add-advanced-default-' | append: section_id | append: card_product.id
                  assign qty_rules = false
                  if card_product.selected_or_first_available_variant.quantity_rule.min > 1 or card_product.selected_or_first_available_variant.quantity_rule.max != null or card_product.selected_or_first_available_variant.quantity_rule.increment > 1
                    assign qty_rules = true
                  endif
                -%}
                <div class="card__function-item card__function-cart z-index-2">
                  {%- if card_product.variants.size > 1 or qty_rules -%}
                    <modal-opener data-modal="#QuickAdd-{{ card_product.id }}" class="d-block{% unless show_quick_add_mobile %} d-none-mw-xl{% endunless %}{% unless show_quick_add %} d-none-xl{% endunless %}">
                      <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                      <button
                        id="{{ product_form_id }}-submit"
                        type="submit"
                        name="add"
                        class="quick-add__submit button-advanced-default pos-relative c-pointer b-none bg-transparent c-gap p-0-i v-a-baseline d-flex a-i-end j-c-center typography-font-body"
                        aria-haspopup="dialog"
                        aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                        data-product-url="{{ card_product.url | split: "?" | first }}?view=quick-view"
                        aria-label="{{ 'templates.cart.cart_items' | t: count: cart.item_count }}"
                        style="--c-gap: 0.6rem;"
                      >
                        <div class="block-text f-w-600">
                          {{ 'products.product.quick_add' | t }}
                        </div>
                        <div class="block-icon">
                          <span class="text d-flex a-i-center j-c-center w-100">
                            {% render 'icon-cart-card' %}
                          </span>
                          <div class="loading-overlay__spinner z-index-2 hidden">{{ icon_spinner }}</div>
                        </div>
                      </button>
                    </modal-opener>
                    <quick-add-modal id="QuickAdd-{{ card_product.id }}" class="quick-add-modal popup-modal d-flex a-i-center j-c-center pos-fixed top-0 left-0 w-100 h-100 o-h m-auto gradient">
                      <div role="dialog" aria-label="{{ 'products.product.choose_product_options' | t: product_name: card_product.title | escape }}" aria-modal="true" class="quick-add-modal__content popup-modal__content w-100 h-auto m-auto o-h pos-relative gradient template-popup global-settings-popup" tabindex="-1">
                        <button id="ModalClose-{{ card_product.id }}" type="button" class="quick-add-modal__toggle popup-modal__toggle d-block t-button b-none c-pointer b-circle pos-absolute z-index-3 button--close" aria-label="{{ 'accessibility.close' | t }}">
                          <span class="i__close e-none d-block pos-relative color-current w-100 h-100"></span>
                        </button>
                        <div id="QuickAddInfo-{{ card_product.id }}" class="quick-add-modal__content-info popup-modal__content-info h-100"></div>
                      </div>
                    </quick-add-modal>
                  {%- else -%}
                    <product-form class="d-block">
                      {%- form 'product',
                        card_product,
                        id: product_form_id,
                        class: 'form',
                        novalidate: 'novalidate',
                        data-type: 'add-to-cart-form'
                      -%}
                        <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                        <button
                          id="{{ product_form_id }}-submit"
                          type="submit"
                          name="add"
                          class="quick-add__submit button-advanced-default pos-relative c-pointer b-none bg-transparent c-gap p-0-i v-a-baseline d-flex a-i-end j-c-center typography-font-body"
                          aria-haspopup="dialog"
                          aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                          aria-live="polite"
                          data-sold-out-message="true"
                          aria-label="{{ 'templates.cart.cart_items' | t: count: 1 }}"
                          style="--c-gap: 0.6rem;"
                          {% if card_product.selected_or_first_available_variant.available == false %}
                            disabled
                          {% endif %}
                        >
                          <div class="block-text f-w-600">
                            {{ 'products.product.quick_add' | t }}
                          </div>
                          <div class="block-icon">
                            <span class="text{% if card_product.selected_or_first_available_variant.available %} d-flex a-i-center{% endif %} w-100">
                              {% render 'icon-cart-card' %}
                            </span>
                            <span class="sold-out-message hidden">
                              {{ 'products.product.sold_out' | t }}
                            </span>
                            <div class="loading-overlay__spinner z-index-2 hidden">{{ icon_spinner }}</div>
                          </div>
                        </button>
                      {%- endform -%}
                    </product-form>
                  {%- endif -%}
                </div>
              {%- endif -%}
            </div>
          </div>
        </div>
      </div>
    </div>
  {%- endif -%}
</li>