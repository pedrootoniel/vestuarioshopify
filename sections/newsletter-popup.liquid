{%- liquid 
  assign show_image = false
  if section.settings.image != blank
    assign show_image = true
  endif
-%}
<div class="newsletter-popup no-js-hidden d-block">
  <side-drawer class="drawer pos-fixed top-0 left-0 z-index-8 w-100v h-100 d-flex a-i-end j-c-end" data-moved="true" id="Popup-Newsletter-{{ section.id }}">
    <newsletter-popup class="side-drawer no-animation--popup w-100"
      data-delay="{{ section.settings.popup_delay | times: 1000 }}" 
      data-expire="{{ section.settings.popup_expire }}" 
    >
      <div id="Drawer-Overlay-Newsletter-Popup-{{ section.id }}" class="drawer__overlay pos-fixed top-0 left-0 right-0 bottom-0 c-pointer"></div>
        <div class="popup-wrapper newsletter__drawer-inner gradient d-flex pos-absolute left-0 bottom-0 center f-column o-h color-{{ section.settings.color_scheme }} gradient" role="dialog" aria-modal="true" aria-label="{{ 'multitasking_bar.title' | t }}" tabindex="-1">
          {%- if show_image -%}
            <div class="newsletter__popup-image {{ section.settings.width }}">
              <img
                srcset="{%- if section.settings.image.width >= 165 -%}{{ section.settings.image | image_url: width: 165 }} 165w{%- endif -%}
                  {%- if section.settings.image.width >= 375 -%},{{ section.settings.image | image_url: width: 375 }} 375w{%- endif -%}
                  {%- if section.settings.image.width >= 550 -%},{{ section.settings.image | image_url: width: 550 }} 550w{%- endif -%}
                  {%- if section.settings.image.width >= 750 -%},{{ section.settings.image | image_url: width: 750 }} 750w{%- endif -%}
                  {%- if section.settings.image.width >= 1100 -%},{{ section.settings.image | image_url: width: 1100 }} 1100w{%- endif -%}
                  {%- if section.settings.image.width >= 1500 -%},{{ section.settings.image | image_url: width: 1500 }} 1500w{%- endif -%},
                  {{ section.settings.image | image_url }} {{ section.settings.image.width }}w"
                class="w-100 h-100 o-f-cover motion-reduce"
                src="{{ section.settings.image | image_url: width: 1500 }}"
                sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 100 | divided_by: 2 }}px, (min-width: 750px) calc((100vw - 130px) / 2), calc((100vw - 50px) / 2)"
                alt="{{ section.settings.image.alt | escape }}"
                loading="lazy"
                width="{{ section.settings.image.width }}"
                height="{{ section.settings.image.height }}"
              />
            </div>
          {%- endif -%}
          <div class="newsletter__popup-content p-extend" style="--p-extend: 2rem;">
            {%- for block in section.blocks -%}
              {%- case block.type -%}
                {%- when 'heading' -%}
                  {%- if block.settings.heading != blank -%}
                    <h2 class="newsletter__drawer-heading {{ block.settings.heading_size | prepend: 'text-size-' }} m-spacing" {{ block.shopify_attributes }}
                      style="
                        --m-spacing-t: {{ block.settings.margin_top }}px;
                        --m-spacing-b: {{ block.settings.margin_bottom }}px;
                      "
                    >
                      {{ block.settings.heading | escape }}
                    </h2>
                  {%- endif -%}
                {%- when 'text' -%}
                  {%- if block.settings.text != blank -%}
                    <div class="newsletter__drawer-text rte {{ block.settings.text_size | prepend: 'text-size-' }} m-spacing" {{ block.shopify_attributes }}
                      style="
                        --color-foreground: {{ block.settings.colors_text.red }}, {{ block.settings.colors_text.green }}, {{ block.settings.colors_text.blue }};
                        --m-spacing-t: {{ block.settings.margin_top }}px;
                        --m-spacing-b: {{ block.settings.margin_bottom }}px;
                      "
                    >
                      {{ block.settings.text }}
                    </div>
                  {%- endif -%}
                {%- when 'newsletter' -%}
                  <div class="newsletter__drawer-newsletter" {{ block.shopify_attributes }}>
                    <div id="newsletter-popup-{{ section.id }}"
                      class="newsletter__content form-is-show d-block m-spacing"
                      role="region"
                      aria-labelledby="Summary-{{ section.id }}"
                      style="
                        --color-foreground: {{ block.settings.colors_text.red }}, {{ block.settings.colors_text.green }}, {{ block.settings.colors_text.blue }};
                        --m-spacing-t: {{ block.settings.margin_top }}px;
                        --m-spacing-b: {{ block.settings.margin_bottom }}px;
                      "
                    >
                      {% form 'customer', id: 'ContactFormPopup', class: 'newsletter-form' %}
                        <input type="hidden" name="contact[tags]" value="newsletter">
                        <div class="newsletter-form__field-wrapper d-flex f-column r-gap{% if form.posted_successfully? %} hidden{% endif %}" style="--r-gap: 1.2rem;">
                          <div class="newsletter-form__field field pos-relative w-100">
                            <input
                              id="NewsletterForm--{{ section.id }}"
                              type="email"
                              name="contact[email]"
                              class="popup__input field__input f-grow center required{% if form.errors %} invalid{% endif %}"
                              value="{{ form.email }}"
                              aria-required="true"
                              autocorrect="off"
                              autocapitalize="off"
                              autocomplete="email"
                              {% if form.errors %}
                                autofocus
                                aria-invalid="true"
                                aria-describedby="Newsletter-error--{{ section.id }}"
                              {% elsif form.posted_successfully? %}
                                aria-describedby="Newsletter-success--{{ section.id }}"
                              {% endif %}
                              placeholder="{{ 'newsletter.label' | t }}"
                              required
                            >
                            <label class="field__label field__label--fixed pos-absolute e-none" for="NewsletterForm--{{ section.id }}">{{ 'newsletter.label' | t }}</label>
                          </div>
                          <button 
                            type="submit" 
                            class="newsletter-form__button button button--main-standard {{ settings.button_style | prepend: 'button--style-' }}{% if block.settings.button_transparent == 'transparent' %} button--transparent{% endif %} w-100 f-b-none" 
                            name="commit" 
                            id="Subscribe" 
                            aria-label="{{ 'newsletter.button_label' | t }}"
                          >
                            <span class="text">
                              {{ block.settings.button_text }}
                            </span>
                          </button>
                        </div>
                        {%- if block.settings.description != blank and form.posted_successfully? == false -%}
                          <div class="newsletter-form__description">
                            {{ block.settings.description }}
                          </div>
                        {%- endif -%}
                        {%- if form.errors -%}
                          <small class="newsletter-form__message newsletter-form__message--error form__message text-body l-h-1 d-inline-flex j-c-center a-i-center" id="Newsletter-error--{{ section.id }}">{% render 'icon-error' %}{{ form.errors.translated_fields['email'] | capitalize }} {{ form.errors.messages['email'] }}</small>
                        {%- endif -%}
                        {%- if form.posted_successfully? -%}
                          <h3 class="newsletter-form__message newsletter-form__message--success form__message text-body l-h-1 m-0 d-inline-flex j-c-center a-i-center" id="Newsletter-success--{{ section.id }}" tabindex="-1" autofocus>{% render 'icon-success' %}{{ 'newsletter.success' | t }}</h3>
                        {%- endif -%}
                      {% endform %}
                    </div>
                    <button
                      class="newsletter__drawer-close link u-link link--style-line d-block b-none bg-transparent m-auto c-pointer"
                      type="button"
                      onclick="this.closest('side-drawer').close()"
                      aria-label="{{ 'accessibility.maybe_next_time' | t }}"
                    >
                      <span class="text link-style d-inline-block">
                        {{ 'accessibility.maybe_next_time' | t }}
                      </span>
                    </button>
                  </div>
              {%- endcase -%}
            {%- endfor -%}
        </div>
      </div>
    </newsletter-popup>
  </side-drawer>

  {%- if section.settings.show_fixed_toolbar -%}
    <side-drawer-opener data-side-drawer="#Popup-Newsletter-{{ section.id }}" class="newsletter-popup-opener pos-fixed z-index-2 d-block f-shrink">
      <button class="item_newsletter-button typography-font-heading f-bold uppercase c-pointer d-block b-none gradient" type="button" aria-label="Newsletter popup"
        style="
          --color-foreground: {{ section.settings.colors_text.red }}, {{ section.settings.colors_text.green }}, {{ section.settings.colors_text.blue }};
          --color-background: {{ section.settings.colors_background.red }}, {{ section.settings.colors_background.green }}, {{ section.settings.colors_background.blue }};
          --gradient-background: {% if section.settings.gradient_background != blank %}{{ section.settings.gradient_background }}{% else %}{{ section.settings.colors_background }}{% endif %};
        "
      >
        <span class="icon-text{% if section.settings.heading != blank %} d-none-md{% endif %}">
          {% render 'icon-newsletter' %}
        </span>
        {%- if section.settings.heading != blank -%}
          <span class="text d-none-xs">
            {{ section.settings.heading }}
          </span>
        {%- endif -%}
      </button>
    </side-drawer-opener>
  {%- endif -%}
</div>

{%- liquid
  assign files = 'newsletter-popup.js'
  assign files = files | split: ', '
  render 'theme-loader', files: files
-%}

{% schema %}
{
  "name": "t:sections.popup.newsletter-popup.name",
  "tag": "section",
  "class": "shopify-section--popup",
  "limit": 1,
  "enabled_on": {
    "groups": ["custom.popup"]
  },
  "settings": [
  {
    "type": "header",
    "content": "t:sections.popup.label__1"
  },
  {
    "type": "checkbox",
    "id": "show_fixed_toolbar",
    "label": "t:sections.popup.newsletter-popup.settings.show_fixed_toolbar.label",
    "default": true
  },
  {
    "type": "text",
    "id": "heading",
    "label": "t:sections.all.heading.label",
    "default": "Newsletter"
  },
  {
    "type": "color",
    "id": "colors_text",
    "default": "#000000",
    "label": "t:sections.all.colors.colors_text"
  },
  {
    "type": "color",
    "id": "colors_background",
    "label": "t:sections.all.colors.colors_background"
  },
  {
    "type": "color_background",
    "id": "gradient_background",
    "default": "linear-gradient(90deg, rgba(246, 238, 227, 1), rgba(223, 244, 247, 1) 100%)",
    "label": "t:sections.all.colors.gradient_background"
  },
  {
    "type": "header",
    "content": "t:sections.popup.label__2"
  },
  {
    "type": "range",
    "id": "popup_expire",
    "max": 30,
    "min": 1,
    "step": 1,
    "unit": "day",
    "label": "t:sections.popup.newsletter-popup.settings.label__1",
    "default": 1
  },
  {
    "type": "range",
    "id": "popup_delay",
    "max": 60,
    "min": 5,
    "step": 1,
    "unit": "s",
    "label": "t:sections.popup.newsletter-popup.settings.label__2",
    "default": 5
  },
  {
    "type": "image_picker",
    "id": "image",
    "label": "t:sections.all.image.label",
    "info": "t:sections.popup.newsletter-popup.settings.info"
  },
  {
    "type": "header",
    "content": "t:sections.all.colors.section_color"
  },
  {
    "type": "color_scheme",
    "id": "color_scheme",
    "label": "t:sections.all.colors.label",
    "default": "background-1"
  }],
  "blocks": [
    {
      "type": "heading",
      "name": "t:sections.image-with-text.blocks.heading.name",
      "limit": 1,
      "settings": [
      {
        "type": "text",
        "id": "heading",
        "default": "Signup for our newsletter",
        "label": "t:sections.all.heading.label"
      },
      {
        "type": "select",
        "id": "heading_size",
        "options": [
        {
          "value": "default",
          "label": "t:sections.all.font_size.options"
        },
        {
          "value": "xx-small",
          "label": "t:sections.all.font_size.options__1"
        },
        {
          "value": "x-small",
          "label": "t:sections.all.font_size.options__2"
        },
        {
          "value": "small",
          "label": "t:sections.all.font_size.options__3"
        },
        {
          "value": "medium",
          "label": "t:sections.all.font_size.options__4"
        },
        {
          "value": "large",
          "label": "t:sections.all.font_size.options__5"
        },
        {
          "value": "x-large",
          "label": "t:sections.all.font_size.options__6"
        },
        {
          "value": "xx-large",
          "label": "t:sections.all.font_size.options__7"
        },
        {
          "value": "xxx-large",
          "label": "t:sections.all.font_size.options__8"
        }],
        "default": "xxx-large",
        "label": "t:sections.all.font_size.label__2"
      },
      {
        "type": "header",
        "content": "t:sections.all.padding.block_padding_heading"
      },
      {
        "type": "range",
        "id": "margin_top",
        "min": 0,
        "max": 100,
        "step": 1,
        "unit": "px",
        "label": "t:sections.all.spacing.margin_top",
        "default": 0
      },
      {
        "type": "range",
        "id": "margin_bottom",
        "min": 0,
        "max": 100,
        "step": 1,
        "unit": "px",
        "label": "t:sections.all.spacing.margin_bottom",
        "default": 8
      }]
    },
    {
      "type": "text",
      "name": "t:sections.image-with-text.blocks.text.name",
      "limit": 1,
      "settings": [
      {
        "type": "inline_richtext",
        "id": "text",
        "default": "Describe what your customers will receive when subscribing to your newsletter.",
        "label": "t:sections.all.text.label"
      },
      {
        "type": "select",
        "id": "text_size",
        "options": [
        {
          "value": "default",
          "label": "t:sections.all.font_size.options"
        },
        {
          "value": "xx-small",
          "label": "t:sections.all.font_size.options__1"
        },
        {
          "value": "x-small",
          "label": "t:sections.all.font_size.options__2"
        },
        {
          "value": "small",
          "label": "t:sections.all.font_size.options__3"
        },
        {
          "value": "medium",
          "label": "t:sections.all.font_size.options__4"
        },
        {
          "value": "large",
          "label": "t:sections.all.font_size.options__5"
        },
        {
          "value": "x-large",
          "label": "t:sections.all.font_size.options__6"
        },
        {
          "value": "xx-large",
          "label": "t:sections.all.font_size.options__7"
        },
        {
          "value": "xxx-large",
          "label": "t:sections.all.font_size.options__8"
        }],
        "default": "default",
        "label": "t:sections.all.font_size.label__3"
      },
      {
        "type": "color",
        "id": "colors_text",
        "default": "#5A5A5A",
        "label": "t:sections.all.colors.colors_text"
      },
      {
        "type": "header",
        "content": "t:sections.all.padding.block_padding_heading"
      },
      {
        "type": "range",
        "id": "margin_top",
        "min": 0,
        "max": 100,
        "step": 1,
        "unit": "px",
        "label": "t:sections.all.spacing.margin_top",
        "default": 0
      },
      {
        "type": "range",
        "id": "margin_bottom",
        "min": 0,
        "max": 100,
        "step": 1,
        "unit": "px",
        "label": "t:sections.all.spacing.margin_bottom",
        "default": 12
      }]
    },
    {
      "type": "newsletter",
      "name": "t:sections.newsletter.blocks.email_form.label__2",
      "limit": 1,
      "settings": [
      {
        "type": "richtext",
        "id": "description",
        "label": "t:sections.all.paragraph.label",
        "default": "<p>Subscribe to our newsletter and be the first to hear about our new arrivals, special promotions and online exclusives.</p>"
      },
      {
        "type": "color",
        "id": "colors_text",
        "default": "#878080",
        "label": "t:sections.all.colors.colors_text"
      },
      {
        "type": "text",
        "id": "button_text",
        "default": "Subcribe",
        "label": "t:sections.all.button_label.label"
      },
      {
        "type": "select",
        "id": "button_transparent",
        "options": [
        {
          "value": "default",
          "label": "t:sections.all.button_style.label__2"
        },
        {
          "value": "transparent",
          "label": "t:sections.all.button_style.label__3"
        }],
        "default": "default",
        "label": "t:sections.all.button_style.label__1"
      },
      {
        "type": "header",
        "content": "t:sections.all.padding.block_padding_heading"
      },
      {
        "type": "range",
        "id": "margin_top",
        "min": 0,
        "max": 100,
        "step": 1,
        "unit": "px",
        "label": "t:sections.all.spacing.margin_top",
        "default": 12
      },
      {
        "type": "range",
        "id": "margin_bottom",
        "min": 0,
        "max": 100,
        "step": 1,
        "unit": "px",
        "label": "t:sections.all.spacing.margin_bottom",
        "default": 12
      }]
    }
  ],
  "presets": [
  {
    "name": "t:sections.popup.newsletter-popup.presets.name"
  }]
}
{% endschema %}